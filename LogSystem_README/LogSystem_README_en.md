# LogSystem Instructions

LogSystem is achieved base on STM32 and FatFS, which can record data into SD card. FatFS is the core of LogSystem, and LogSystem is just a further encapsulation of FatFS source code. The following picture is the directory structure of the LogSystem folder.

![文件夹目录](FolderDirectory.png)

In this file：

- **example**：The example of using LogSystem, which is based on STM32CubeMX and the A-board of DJI.
- **FATFS**：The source code of FatFS.
- **LogSystem**：The code of LogSystem, including LogSystem.c and LogSystem.h。
- **LogSystem_README**：LogSystem instructions，which is written by markdown and has Chinese version and English version.

## FatFS Introduction

FatFS is a file system which is suitable for small embedded devices and is open source. The following picture is the directory structure of FatFS source code folder, and its version is R0.12c.

![FatFS R0.12c版本目录](FatFS_Directory-R0-12c.png)

In this file：

- **option**：This folder contains some optional external C files, including files and conversion functions required for multi-language support.
- **00history.txt**：This file records the version update of FatFS.
- **00readme.txt**：This file introduces the functions of the files and folders in this directory.
- **diskio.c**：This file contains the operating functions to the storage media of low-level, which is need to completed according to different storage media.
- **diskio.h**：This file defines the marcos which are used in FatFS, and the functions declarations of the interface related to low-level haraware in diskio.c.
- **ff.c**：The achievement of file management, including file operation functions.
- **ff.h**：This file defines the marcos which are used in ff.c and declares related functions.
- **ff_gen_drv.c**：This file contains general low-level driver functions.
- **ff_gen_drv.h**：The head file of ff_gen_drv.c.
- **ffconf.h**：The configuration file of FatFS, which defines the related parameters of FatFS.
- **ffconf_template.h**：A template of ffconf.h。
- **integer.h**：The Definitions of some numeric types.
- **st_readme.txt**：This file lists the main modification done by STMicroelectronics on FatFs for integration with STM32Cube solution.

After the code generation of STM32CubeMX, the folder directory maybe different, but there is not much impact.

## STM32CubeMX Configuration

Click "SYS" on left, and choose "Serial Wire" in "Debug".

![第一步](STM32CubeMX1.png)

Click "RCC" on left, click "High Speed Clock", choose "Crystal/Ceramic Resonator".

![第二步](STM32CubeMX2.png)

Config the clock tree.

![第三步](STM32CubeMX3.png)

Click "Connectivity" on left, choose "SDIO", choose "SD 1 bit" in "Mode", and set the parameters in "Parameters Setting".

![第四步](STM32CubeMX4.png)

Click "Middleware" on left, choose "FATFS", choose "SD card" in "Mode". "User-defined" is optional.

![第五步](STM32CubeMX5.png)

Enter the "Set Defines" of FATFS, config parameters according to the following two pictures. You can also config parameters after reading the source code of FatFS, based on the understanding of yourself.

![第六步](STM32CubeMX6.png)

![第六步](STM32CubeMX7.png)

Advanced Settings.

![第七步](STM32CubeMX8.png)

Enter "Project Manager"，determine the location of the project, name the project, select an IDE or compilation tool, and choose how to generate code.

![最后](STM32CubeMX9.png)

![最后](STM32CubeMX10.png)

## Make some modifications to the code generated by STM32CubeMX

Find fatfs.c, and modify it like the following picture.

![一点修改](ChangeCode1.png)

## End

LogSystem.c and LogSystem.h both have corresponding comments to explain the code. If you think there are deficiencies in the LogSystem code library during use, you are welcome to point them out, and you are also welcome to improve LogSystem yourself.
